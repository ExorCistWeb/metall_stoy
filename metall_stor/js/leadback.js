(function(){this.inArray=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1},this.glob=function(e){for(var t=e.split("."),o=window,i=0,n=t.length;i<n;i++)a=t[i],o[a]=o[a]||{},o=o[a];return o},glob("ldbck");var e,t,o,i,n=ldbck;if(window._emv){if(window.ldbck_loaded)return n.log("multiple instance detected"),!1;window.ldbck_loaded=!0}if(n.DEBUG=!1,n.ACCEPT_CHATS=!1,n.version="v1.12.18b010622",n.DOMAIN=n.DEBUG?"branch.leadback.local":"string"==typeof _emv.cdn?_emv.cdn:"leadback.ru",n.CHAT_CDN=n.DEBUG?"//cloudim.local/js/":"//cloudim.ru/js/",n.JQUERY_URL="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js?ldbck_v="+n.version,n.JS_CDN="//"+n.DOMAIN+"/js/",n.PUBLIC_SERVER=(n.DEBUG?"//":"https://")+n.DOMAIN+"/",n.JQUERY_VERSIONS="3.3.1 3.2.1 3.1.1 2.2.4 2.1.1 1.12.4 1.11.3 1.11.2 1.11.1 1.11.0 1.10.2 1.10.1 1.10.0 1.9.1 1.9.0".split(" "),n.LAST_SPEED=n.LEAVE_POINT=n.LAST_X_POSITION=n.LAST_Y_POSITION=0,n.timer=27e3,n.activity=0,n.clock=null,n.stat={x:null,y:null,s:null,t:0,a:0,l:0},n.total_time=0,n.last_visit_timeout=0,n.visit_date=null,n.Chat={},n.storage=null,n.dom_is_ready=null,n.restarted=!1,n.is_multibutton=null,n.$multibutton=null,n.beforeOpenWidget=null,n.successCallCallback=null,n.chat_settings=null,n.form_settings=null,"function"==typeof _emv.successCallCallback&&(n.successCallCallback=_emv.successCallCallback),n.onApiReady=[],"function"==typeof _emv.onApiReady)n.onApiReady.push(_emv.onApiReady);else if("object"==typeof _emv.onApiReady)for(var l=0,r=_emv.onApiReady.length;l<r;l++)"function"==typeof _emv.onApiReady[l]&&n.onApiReady.push(_emv.onApiReady[l]);n.is_vk=_emv.is_vk||!1,n.debug_window=_emv.debug_window||!1;try{n.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),n.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)}catch(e){}h=_emv.campaign,n.cc="__leadback_"+h,n.ct="__leadback_timeout_"+h,n.cg="__leadback_guid_"+h,n.storage_type="cookie",n.countDownInterval=null,n.replacedTags={},-1!=n.DOMAIN.indexOf("leadback.")&&(window.GoogleAnalyticsObject||(e=window,t=document,i="script",o="ga",e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,o=t.createElement(i),i=t.getElementsByTagName(i)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",i.parentNode.insertBefore(o,i)),"function"==typeof ga&&(ga("create","UA-53479583-2","auto",{name:"ldbckTracker"}),ga("ldbckTracker.send","pageview"))),n.ga_cid=null,"function"==typeof ga&&ga((function(){n.getGoogleCid()}));var s=0,d=setInterval((function(){s++,n.getGoogleCid()?(n.log("Ga cid found",n.getGoogleCid()),d&&(clearInterval(d),d=null)):5<s&&(d&&(clearInterval(d),d=null),n.log("Ga cid not found by interval"))}),500);n.getGoogleCid=function(){return null===n.ga_cid&&"function"==typeof ga&&"function"==typeof ga.getAll&&ga.getAll().length&&(n.ga_cid=ga.getAll()[0].get("clientId"),d&&(clearInterval(d),d=null)),n.log("getGoogleCid",n.ga_cid),n.ga_cid},n.ya=[],n.ya_cid=null,n.ya_counter=null;var u=0,g=setInterval((function(){for(var e in u++,window)0==e.indexOf("yaCounter")&&("function"==typeof window[e].getClientID&&null===n.ya_cid&&(n.ya_cid=window[e].getClientID(),n.ya_counter=e.toLowerCase().replace("yacounter",""),n.log("YA CID:"+n.ya_cid),n.log("YA COUNTER:"+n.ya_counter)),"function"==typeof window[e].reachGoal&&(n.ya[n.ya.length]=e,n.log("Ya: "+n.ya.length)));0<n.ya.length?clearInterval(g):5<u&&(clearInterval(g),n.log("Ya not found"))}),500);function _(){for(var e=0,t={};e<arguments.length;e++){var o,i=arguments[e];for(o in i)t[o]=i[o]}return t}if(n.init=function(){n.log("init");try{var e=document.location.href,t=-1!==e.indexOf("&_cobrowsing=true")||-1!==e.indexOf("?_cobrowsing=true");if(window!=window.top&&!n.is_vk||t)return void n.log("in frame")}catch(e){}n.activity=n.DEBUG?1:n.randomVal(10,20),n.$.ajaxSetup({async:!0}),n.storage_type="local";try{void 0!==n.Cookies.get("__leadback_ver")&&(n.Cookies.remove(n.cc,{path:"/"}),n.Cookies.remove(n.ct,{path:"/"}),n.Cookies.remove("__leadback_ver",{path:"/"}))}catch(e){}return n.log("Storage type is: "+n.storage_type),n.storage=n.initStorage(_emv.campaign),n.initWidget()},n.getStorageType=function(e){var t=n.storage_type;return e!=n.cg||n.is_vk?t:"cookie"},n.getCookie=function(e){var t=n.getStorageType(e);return"cookie"==t?n.Cookies.getJSON(e):"local"==t?void 0===(t=n.storage.localStorage.get(e))?t:void 0!==t.expires&&"string"==typeof t.expires&&new Date(t.expires)<new Date?void n.removeCookie(e):t.value:void 0},n.setCookie=function(e,t,o){var i=n.getStorageType(e);return"cookie"==i?n.Cookies.set(e,t,o):"local"==i?(void 0===o.expires&&(o.expires=0),n.storage.localStorage.set(e,{value:t,expires:o.expires})):void 0},n.removeCookie=function(e,t){var o=n.getStorageType(e);return"cookie"==o?n.Cookies.remove(e,t):"local"==o?n.storage.localStorage.remove(e):void 0},n.restart=function(e){return n.restarted=!0,n.unloadWidget(),n.timer=27e3,n.clock=null,n.stat={x:null,y:null,s:null,t:0,a:0,l:0},n.total_time=0,n.last_visit_timeout=0,n.Chat={},n.storage=null,n.dom_is_ready=null,e&&n.restartStorage(e),n.$("#lb_widget-root").remove(),n.initWidget()},n.restartStorage=function(e){_emv.campaign=e,n.cc="__leadback_"+e,n.ct="__leadback_timeout_"+e,n.cg="__leadback_guid_"+e,n.storage=n.initStorage(e)},n.initWidget=function(){if(n.log("initWidget"),"#demomode"!=window.location.hash&&"#debug"!=window.location.hash||(n.log("Demo mode ON"),n.removeCookie(n.cc,{path:"/"}),n.removeCookie(n.ct,{path:"/"}),void 0!==n.getCookie(n.cg)&&n.setCookie(n.cg,{guid:n.getCookie(n.cg).guid,converted:!1,t:n.getCookie(n.cg).t},{path:"/",expires:99999})),n.visit_date=new Date,c=function(){n.$.ajax({type:"GET",url:n.PUBLIC_SERVER+"backend/widget_data.php",dataType:"json",data:{widget_key:_emv.campaign,h:window.location.host,cache:Math.random(),tz_offset:n.getTz()},success:function(e){n.log("Campaign Loaded from Server",e),void 0===e.widget_key&&n.log("Invalid widget_key");var t=new Date((new Date).getTime()+18e4),o=!(n.W={widget_key:e.widget_key,user_id:e.user_id,active:e.active,active_changed:e.active_changed||!1,night_mode:e.night_mode,catch_on_exit:e.catch_on_exit,catch_by_timer:e.catch_by_timer,catch_by_timer_time:e.catch_by_timer_time,allow_multiple_conversions:e.multiple_conversions,timeout:e.timeout,callback_time:e.callback_time,float_button:e.float_button,mobile_button:e.mobile_button,country:e.country||"ru",lang:e.lang||"ru",position:e.position,chat:e.chat||0,chat_uid:e.chat_uid||0,chat_id:e.chat_id||0,tooltip_scroll:e.tooltip_scroll,tooltip_hover:e.tooltip_hover,suitable_time:e.suitable_time,magic_forms:e.magic_forms,magic_forms_callback:e.magic_forms_callback,magic_forms_night_mode:e.magic_forms_night_mode,facebook_pixel_id:e.facebook_pixel_id||"",facebook_pixel_event:e.facebook_pixel_event||"",status:e.status,block_desc:e.block_desc,hide_call_timer:e.hide_call_timer,faq_settings:e.faq_settings});return n.W.widget_key!=_emv.campaign&&(n.log("is_geo_office = true"),n.storage=null,n.restartStorage(n.W.widget_key),o=!0),e.chat&&e.chat_uid&&e.chat_data&&(e.chat_data.operators&&n.storage.localStorage.set("chat_operators",e.chat_data.operators),e.chat_data.settings&&(n.storage.localStorage.set("chat_settings",e.chat_data.settings),n.chat_settings=e.chat_data.settings,n.W.chat_init="hide")),e.form_settings&&(n.form_settings=e.form_settings,n.storage.localStorage.set("form_settings",e.form_settings)),void 0!==e.url_config&&void 0!==e.url_config.urls&&0<e.url_config.urls.length?n.storage.localStorage.set("url_config",e.url_config):n.storage.localStorage.remove("url_config"),void 0!==e.scheduler&&void 0!==e.scheduler.days&&void 0!==e.scheduler.times?n.storage.localStorage.set("scheduler",e.scheduler):n.storage.localStorage.remove("scheduler"),void 0!==e.departments&&1<e.departments.length?n.storage.localStorage.set("departments",e.departments):n.storage.localStorage.remove("departments"),n.setCookie(n.cc,n.W,{path:"/",expires:t}),o?n.initWidget():n.campaignLoaded(e)},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpCallback"})},n.restarted||(n.$(window).on("beforeunload",(function(){n.unloadWidget()})),setInterval((function(){n.stat.t++,n.total_time++,n.stat.a=n.total_time}),1e3)),void 0===n.getCookie(n.cg))return b=ldbck.generateUUID(),n.setCookie(n.cg,{guid:b,converted:!1,t:0},{path:"/",expires:99999}),ldbck.log("New GUID Cookie Created"),n.removeCookie(n.cc,{path:"/"},c());if(ldbck.log("Loaded GUID Cookie"),n.total_time=n.getCookie(n.cg).t,void 0!==n.getCookie(n.cg).l&&(n.last_visit_timeout=Math.round(((new Date).getTime()-n.getCookie(n.cg).l)/1e3)),n.log("self.last_visit_timeout="+n.last_visit_timeout),void 0===n.getCookie(n.cc))return c();if(ldbck.log("Campaign Loaded from Cookie"),b=n.getCookie(n.cc),b.chat&&b.chat_uid&&!0===n.storage.localStorage.isEmpty("chat_operators"))return n.log("force LOAD Campaign (empty storage)"),c();n.W=b;try{clearInterval(n.countDownInterval)}catch(e){}return n.campaignLoaded(b)},n.unloadWidget=function(){if(void 0!==n.getCookie(n.cg)&&(n.setCookie(n.cg,{guid:n.getCookie(n.cg).guid,converted:n.getCookie(n.cg).converted,t:n.total_time,l:(new Date).getTime()},{path:"/",expires:99999}),window._emv))try{delete window.ldbck_loaded}catch(e){}},n.campaignLoaded=function(e){if(n.log("compaignLoaded",n.W),"block"==n.W.widget_key)return n.W.block_desc&&console.log("Widget is blocked. Reason: "+n.W.block_desc),!1;if("0"==n.W.status)return n.log("Widget is turn off!");if(!n.W.active&&!n.W.night_mode&&!n.is_vk)return n.log("Not active!");if(!n.storage.localStorage.isEmpty("url_config")){var t=n.storage.localStorage.get("url_config"),o=document.location.href;try{o=decodeURIComponent(document.location.href)}catch(e){n.log(e)}for(var i,a="allow"!=t.rule,l=0,r=t.urls.length;l<r;l++){i=(i=t.urls[l]).replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&").replace(/([*])/g,".+"),0!==t.urls[l].indexOf("http:")&&0!==t.urls[l].indexOf("https:")||-1!==t.urls[l].indexOf("*")||(n.log("full url pattern: "+i),i="^"+i+"$");var s=new RegExp(i);if(n.log("CHECK pattern["+t.rule+"]:"+i),s.test(void 0)||s.test(o)){if("allow"==t.rule){n.log("ALLOWED: "+i),a=!0;break}if("deny"==t.rule){n.log("DENIED: "+i),a=!1;break}}}if(!1===a)return n.log("Not allowed by url config")}var c,d;n.W.callback_time&&(n.timer=1e3*n.W.callback_time),c=n.getCookie(n.cg).converted,d=n.W.allow_multiple_conversions,n.is_vk?n.insertWidget(n.W,!0):("1"==n.W.chat&&n.W.chat_id&&n.W.chat_uid&&"undefined"==typeof Cloudim&&(n.log("Chat IS ON",n.W.chat_id),n.loadScript(n.CHAT_CDN+"chat.js?v2.2",!0,(function(){n.log("Chat IS loaded"),Cloudim.Options.Chat.silent=!0,n.DEBUG&&(Cloudim.Options.debug=!0);var e,t="rand";n.storage.localStorage.isEmpty("chat_settings")||void 0!==(e=n.storage.localStorage.get("chat_settings")).operators_queue&&(t=e.operators_queue),"all"!=t&&4543!=n.W.user_id||(n.ACCEPT_CHATS=!0,Cloudim.Options.accept_chats=!0),Cloudim.Api.bind("onInit",(function(e){n.log("Chat EVENT onInit");var t=!1;"#demomode"==window.location.hash&&(n.log("Demo CHAT mode ON"),window.location.hash="#demomode-chat",Cloudim.Api.clearCache(),t=!0),n.Chat.widget_key||n.loadScript(n.JS_CDN+"leadback-chat-api.js?v="+n.version,!0,(function(){n.log("LOADED leadback-chat-api.js",n.version);var e=setInterval((function(){var o,i;!0===n.dom_is_ready?(clearInterval(e),n.Chat=_LBCHATAPI.init(n,n.W),n.Events._callEvent("onChatReady",n.Chat.Api),t?(n.log("CHAT IS Clear"),n.Chat.removeAllChatState(),window.location.reload()):(o=[],n.storage.localStorage.isEmpty("user_info")||(i=n.storage.localStorage.get("user_info"),o.push({name:"fullName",value:i.name}),o.push({name:"Email",value:i.email}),o.push({name:"Phone",value:i.phone})),0<o.length&&Cloudim.Api.sendUserData(o))):n.log("wait_insert_widget...")}),100)}))})),Cloudim.Api.bind("onReady",(function(){n.log("Chat EVENT onReady"),Cloudim.Api.bind("onOperatorChange",(function(e){n.DEBUG&&alert("operatorChanged"),e.operator&&n.Chat.acceptChat(e.operator)})),Cloudim.Api.bind("onExternalEvent",(function(e){n.log("Chat EVENT onExternalEvent"),"xmpp.operator.cobrowse.internal.page"==e.event&&n.coBrowseV2()})),n.$("#cloudim_chat").hide();var e=setInterval((function(){n.Chat.widget_key&&(clearInterval(e),n.$(window).bind("hashchange",(function(){"#chatopen"==window.location.hash&&(window.location.hash="#chatopen-done",null!==n.Chat.is_online&&(n.Chat.openChat(),n.Chat.scrollChatsToBottom(!0)))})),Cloudim.Api.getCurrentOperator((function(e){if(n.log("check Offline mode",e),n.ACCEPT_CHATS&&1<e.length&&n.Chat.setAcceptChatMode(e),!1===e)if(n.log("Chat EVENT Offline"),n.Chat.getChatSettings("offline_invite"))if(!1!==n.Chat.is_online){n.Chat.setOfflineMode();var t,o=n.storage.localStorage.get("chat_operators"),i=Math.round(Math.random()*(o.length-1));n.storage.localStorage.isEmpty("chat_operator")?n.storage.localStorage.set("chat_operator",i):0<=(t=n.storage.localStorage.get("chat_operator"))&&t<o.length&&(i=t),e=o[i],n.Chat.setOperator(e.operator_name,e.avatar_url),n.Chat.clearChatHistroy();o=n.Chat.getChatInviteState(),i=n.Chat.getChatSettings("offline_invite_goal");var a=[];if(a[0]=n.Chat.getChatSettings("offline_invite_greeting"),void 0===i||"bot"==i||"bot_contacts"==i?(a[1]=n.Chat.getChatSettings("offline_invite_offer"),a[2]=n.Chat.getChatSettings("offline_invite_action"),n.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").show()):(a[1]=n.Chat.getChatSettings("offline_invite_offer_2"),a[2]=n.Chat.getChatSettings("offline_invite_action_2"),n.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").hide()),(e=[])[0]=n.Chat.getChatSettings("offline_invite_call_offer"),e[1]=n.Chat.getChatSettings("offline_invite_call_action"),o.called||o.converted){if(n.log("converted & called"),void 0===i||"bot"==i||"bot_contacts"==i){n.Chat.toggleOperatorButton(),n.Chat.inviteVisitorInChat(a,!0,!0);var l=n.Chat.readLocalMessages();if(l&&l.length)for(var r=0,s=l.length;r<s;r++)n.Chat.addMessageInChat(l[r],"visitor",new Date,!0);n.Chat.inviteVisitorInCall(e,!0)}}else o.readed||o.invited?(n.log("invited & readed"),n.Chat.removeLocalMessages(),n.Chat.toggleOperatorButton(),n.Chat.inviteVisitorInChat(a,!0,o.readed)):(n.log("NOT invited"),n.Chat.removeLocalMessages(),o=n.Chat.getChatSettings("offline_invite_delay"),n.log("getChatSettings -> offline_invite_delay",o),setTimeout((function(){n.log("RUN OFFLINE INVITE"),n.Chat.toggleOperatorButton(),n.Chat.inviteVisitorInChat(a),n.Chat.saveChatInviteState(!0,!1,!1,!1)}),1e3*o))}else n.log("Chat now in offline -> exit");else n.log("Chat offline_invite IS OFF");else n.Chat.showChatButton()})))}),100)})),Cloudim.Api.bind("onShowTab",(function(e){n.log("Chat EVENT onShowTab")})),Cloudim.Api.bind("onClose",(function(){n.log("Chat EVENT onClose")})),Cloudim.Api.bind("onOpen",(function(){n.log("Chat EVENT onOpen")})),Cloudim.Api.bind("onMessage",(function(e){n.log("Chat EVENT onMessage"),clearTimeout(n.Chat.operator_answer_timeout),clearTimeout(n.Chat.operator_wait_timeout),n.Chat.stopAnswerSimulation(),n.Chat.addMessageInChat(e.message,"operator",null,null,e.silent),void 0!==e.data&&"string"==typeof e.data.cobrowsing&&n.Chat.startCoBrowsing(e.data.cobrowsing,"Оператор",e.message),n.Chat.clearFaqMessages(),n.Chat.saveIsLiveChat(),n.Chat.chatIsOpen()||(n.Chat.addOperatorMessageInBaloon(e.message,!n.Chat.isLayoutBalloonVisible()),n.Chat.isLayoutBalloonVisible()||n.Chat.showLayoutBalloon(!1),n.Chat.increaseBadge(),e=n.Chat.getChatState(),n.Chat.saveChatState(e.open,+e.unread+1))})),Cloudim.Api.bind("onClientMessage",(function(e){n.log("Chat EVENT onClientMessage"),n.Chat.addMessageInChat(e.message,"visitor",null,null,!0)})),Cloudim.Api.bind("onTyping",(function(e){n.log("Chat EVENT onTyping"),clearTimeout(n.Chat.operator_answer_timeout),clearTimeout(n.Chat.operator_wait_timeout),!0===e.typing?n.Chat.operatorWriting():!1===e.typing&&n.Chat.operatorNotWriting()})),Cloudim.Api.bind("onOnline",(function(){n.log("Chat EVENT onOnline");var e=setInterval((function(){n.Chat.widget_key&&(clearInterval(e),null===n.Chat.initial_status?(n.Chat.showChatButton(),Cloudim.Api.getVisitor((function(e){e.chatted&&n.Chat.toggleOperatorButton();var t=n.Chat.getChatState();if(0<t.unread)for(var o=0;o<t.unread;o++)n.Chat.increaseBadge();n.Chat.clearChatHistroy(),n.Chat.loadHistory(e.history),e.jid&&n.Chat.setVisitorJid(e.jid),(t.open&&!n.isMobile()||"#chatopen"==window.location.hash)&&(n.Chat.openChat(),n.Chat.scrollChatsToBottom(!0),"#chatopen"==window.location.hash&&(window.location.hash="#chatopen-done"))})),Cloudim.Api.getCurrentOperator((function(e){var t,o,i,a,l;n.log("getCurrentOperator",e),n.ACCEPT_CHATS&&1<e.length&&n.Chat.setAcceptChatMode(e),e?(n.Chat.setOnlineMode(),a=n.Chat.getChatInviteState(),n.log("invite_state",a),t=n.Chat.getChatSettings("chat_invite"),n.log("getChatSettings -> chat_invite",t),o=n.Chat.isChattedVisit(),n.log("isChattedVisit -> is_chatted_visit",o),n.Chat.initFaq(),t&&!o&&((i=[])[0]=n.Chat.getChatSettings("chat_invite_greeting"),i[1]=n.Chat.getChatSettings("chat_invite_offer"),i[2]=n.Chat.getChatSettings("chat_invite_action"),n.log("getChatSettings -> invite messages",i),a.invited?a.invited&&!a.readed?(n.Chat.toggleOperatorButton(),n.Chat.inviteVisitorInChat(i,!0)):a.invited&&a.readed&&!a.converted&&(n.Chat.toggleOperatorButton(),n.Chat.inviteVisitorInChat(i,!0,!0)):(l=n.Chat.getChatSettings("invite_delay"),n.log("getChatSettings -> invite_delay",l),clearTimeout(n.Chat.invite_timeout),n.Chat.invite_timeout=setTimeout((function(){n.log("RUN INVITE"),n.Chat.toggleOperatorButton(),n.Chat.inviteVisitorInChat(i),n.Chat.saveChatInviteState(!0,!1,!1,!1)}),1e3*l))),a=n.storage.localStorage.get("chat_operators"),(l=n.Chat.getCurrentOperator(e,a))?n.Chat.setOperator(l.operator_name,l.avatar_url):0<a.length&&0<e.length&&(a=n.Chat.getOnlineWidgetOperators(a,e)).length?n.Chat.setOperator(a[0].operator_name,a[0].avatar_url):n.Chat.setOperator("Оператор","/images/portraits/2.jpg")):n.log("Chat EVENT Offline")})),n.Chat.Events._callEvent("onOnline")):n.log("IGNORE Chat EVENT onOnline"))}),100)})),n.DEBUG?(n.log("Chat DEBUG is ON"),Cloudim.Chat.init({uid:20621})):Cloudim.Chat.init({uid:n.W.chat_uid,group:n.W.chat_id})}))),n.loadScript(n.JS_CDN+"_assets.min.js?v="+n.version,!0,(function(){if(n.W.float_button&&n.log("float_button IS ON"),n.isMobile())n.W.mobile_button?n.insertWidget(n.W):n.log("mobile_button IS OFF");else if(n.$(window).on("hashchange",(function(){"#callback"==window.location.hash&&(n.insertWidget(n.W,!0),window.location.hash="#callback-showed")})),"#leadback"==window.location.hash)setTimeout((function(){n.insertWidget(n.W,!0)}),3e3);else{if(!c||d||n.W.float_button)return n.insertWidget(e);n.log("Already Converted!")}}))),n.sendEvent("pageview")},n.insertWidget=function(e,t){if(!0===n.dom_is_ready)return n.log("Widget has be inserted"),void(t&&n.showWidget(n.$("#lb_widget-root")));n.log("insertWidget");var o=window.location.host;o=encodeURI(n.PUBLIC_SERVER+"backend/widget_widget.php?h="+o+"&widget_key="+n.W.widget_key+"&v="+n.version);if(n.is_vk?n.DEBUG||(o+="&vk_api="+encodeURIComponent(document.location.href)):(n.isMobile()?(o+="&mobile",o+="&chat="+n.W.chat):(o+="&chat="+n.W.chat,n.log("self.W.chat_init",n.W.chat_init)),"1"==n.W.chat&&n.W.chat_init&&(o+="&chat_init="+n.W.chat_init)),n.log("url",o),n.$.ajax({type:"GET",async:!0,cache:!0,url:o,error:function(e,t,o){return n.log(o),n.log("Main HTML Failed to Load")},success:function(e){var o="";o=""==n.W.position?"bottom: 50px; right: 50px":n.W.position;var i=n.$("<div id='lb_widget-root'><div id='lb_widget-wrapper' style='display:none;'></div><div id='lb_eula_widget-wrapper' style='display:none;'></div><div id='lb_button-wrapper' style='position: fixed; "+o+" ; z-index: 10000000000;'></div></div>");if(i.find("#lb_widget-wrapper").html(e.html).hide(),i.find("#lb_eula_widget-wrapper").html(e.eula).hide(),i.find("#lb_widget-wrapper .lb_callback_time").text(n.W.callback_time||27),!n.storage.localStorage.isEmpty("scheduler")&&(!n.W.active&&n.W.night_mode&&(void 0===n.W.suitable_time||"nigth"==n.W.suitable_time)||void 0!==n.W.suitable_time&&"always"==n.W.suitable_time)){var a=n.storage.localStorage.get("scheduler");if("object"==typeof a&&0<a.days.length){i.on("click","#lb_widget-scheduler--link",(function(e){e.preventDefault(),i.find("#lb_widget-scheduler").show(),i.find("#lb_widget-invite").hide(),i.find("#lb_timer").hide(),i.find("#lb_widget-scheduler--controls").hide(),i.find("#lb_widget-scheduler").data("opened",!0)})),i.on("change","#lb_widget-scheduler--days",(function(e){var t=n.$("option:selected",this).data();if(null!==t){i.find("#lb_widget-scheduler--times").empty();for(var o=0,l=a.times[t.index].length;o<l;o++)i.find("#lb_widget-scheduler--times").append('<option value="'+n.escapeHtml(a.times[t.index][o].value)+'">'+n.escapeHtml(a.times[t.index][o].label)+"</option>")}}));for(var l=0,r=a.days.length;l<r;l++)i.find("#lb_widget-scheduler--days").append('<option value="'+n.escapeHtml(a.days[l].value)+'" data-index="'+l+'">'+n.escapeHtml(a.days[l].label)+"</option>");i.find("#lb_widget-scheduler--days").trigger("change"),i.find("#lb_widget-scheduler--controls").show(),n.W.active||"use_holidays"!==n.W.active_changed||i.find("#lb_widget-scheduler--link").click()}}if(!n.storage.localStorage.isEmpty("departments")){var s=n.storage.localStorage.get("departments");for(l=0,r=s.length;l<r;l++)i.find("#lb_widget-department--items").append('<label class="lb_widget-radio"><input type="radio" name="lb_widget-department--value" data-index="'+l+'" value="'+n.escapeHtml(s[l])+'" '+(0==l?'checked="checked"':"")+"/>&nbsp;"+n.escapeHtml(s[l])+"</label>")}if(n.parseWidgetText(i),n.isMobile()){n.$multibutton=i.find("ldiv.lb-widget"),n.is_multibutton=!!n.$multibutton.length,i.find("#lb_exit").on("click",(function(){n.hideWidget(i)}));var c,d=i.find("#lb_mobile-call"),u=i.find(".lb_mobile-wrapper");if(n.$("body").on("click",'a[href="#callback"]',(function(e){n.showWidget(i),e.preventDefault()})),n.$("body").on("click","#lb_widget-root a.js-trigger-callback",(function(e){n.showWidget(i),e.preventDefault()})),n.$(window).on("hashchange",(function(){"#callback"==window.location.hash&&(n.showWidget(i),window.location.hash="#callback-showed")})),"1"==n.W.chat){try{n.$(window).on("ready",(function(){var e=n.screen_width/window.innerWidth;i.find(".lb-widget-button").css("zoom",1/e),i.find(".lb-widget-welcome-panel").css("zoom",1/e)}))}catch(e){}d.on("click",(function(){n.showWidget(i)}))}else n.$(window).on("orientationchange load",(function(){90==window.orientation||-90==window.orientation?(n.screen_width=Math.max(window.screen.availWidth,window.screen.availHeight),n.screen_height=Math.min(window.screen.availWidth,window.screen.availHeight)):(n.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),n.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)),n.mobileButton(d,u)})),n.$(window).on("touchmove",(function(){n.mobileButton(d,u)})),n.$(window).on("touchstart",(function(){d.css("opacity",0)})),n.$(window).on("touchend",(function(){d.css("opacity",1),n.mobileButton(d,u)})),n.$(window).on("scroll",(function(){d.css("opacity",0),clearTimeout(c),c=setTimeout((function(){d.css("opacity",1),n.mobileButton(d,u)}),300)})),n.mobileButton(d,u),n.is_multibutton?(i.on("click","#lb_widget-wrapper .lb-widget-button",(function(e){n.$multibutton.toggleClass("lb-widget--open-dialog")})),i.on("click","#lb_widget-wrapper .lb-action-link--discard",(function(e){e.preventDefault(),n.$multibutton.toggleClass("lb-widget--open-dialog")})),i.on("click","#lb_widget-wrapper .lb-widget > .lb-overlay",(function(e){e.preventDefault(),n.$multibutton.toggleClass("lb-widget--open-dialog")})),n.startMultiButtonSlides()):d.find(".lb-click_area").on("click",(function(){n.showWidget(i)}));u.find("input.lb_input").on("focus",(function(){u.find(".lb_title-desc").hide(),u.find(".lb_form-label").show()})),!n.is_multibutton||(o=i.find("#lb-multibutton-style-os")).length&&(n.isIOS()?o.attr("href",n.PUBLIC_SERVER+"/css/multibutton/style-ios.min.css?"+n.version):o.attr("href",n.PUBLIC_SERVER+"/css/multibutton/style-android.min.css?"+n.version),o.on("load",(function(){setTimeout((function(){n.$multibutton.show(),n.$multibutton.find(".lb-overlay").attr("style",""),n.$multibutton.find(".lb-dialog").attr("style","")}),50)})))}else{if(n.$('a[href="#callback"]').on("click",(function(e){n.showWidget(i),e.preventDefault()})),n.W.float_button&&e.button){i.find("#lb_button-wrapper").html(e.button),"1"==n.W.chat&&i.find(".phone-call_wave").removeClass("phone-call_wave__stroke");var g=i.find(".lb_button_tooltip--container .lb_button_tooltip--text").html();g=n.parseMacros(g);if(g=n.parseInlineTemplates(g),g=n.parseCountDownMacros(g),i.find(".lb_button_tooltip--container .lb_button_tooltip--text").html(g),i.find("#lb_button-call").hasClass("lb_fixed-button"))i.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",(function(){n.showWidget(i),i.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(i.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),n.storage.localStorage.set("tooltip_closed",!0))}));else if("0"!=n.W.chat||n.isTouch())i.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",(function(){n.showWidget(i),i.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(i.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),n.storage.localStorage.set("tooltip_closed",!0))}));else{i.find("#lb_button-wrapper").attr("title","Нажмите, чтобы заказать обратный звонок или перетащите, если кнопка мешает навигации.");try{n.$(i.find("#lb_button-call")[0]).draggableTouch().on("dragstart",(function(e,t){this.ignoreClick=!1,t&&(this.startPosition=t)})).on("dragend",(function(e,t){t&&(this.startPosition.top-t.top==0||this.startPosition.left-t.left==0||(this.ignoreClick=!0))})),i.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",(function(){i.find("#lb_button-call")[0].ignoreClick||(n.showWidget(i),i.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(i.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),n.storage.localStorage.set("tooltip_closed",!0)))}))}catch(e){i.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",(function(){n.showWidget(i),i.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(i.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),n.storage.localStorage.set("tooltip_closed",!0))}))}}var h,_=null,m=(n.$(document).innerHeight()-n.$(window).height())/n.$(window).height();"0"==n.W.chat&&.5<m?(i.find("#lb_button-wrapper").show(),i.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),n.$(document).on("scroll",(function(){if(n.widgetIsShow(i))return!0;var e=n.$(document).scrollTop()/(n.$(document).innerHeight()-n.$(window).height());i.find("#lb_button-wrapper .lb_call-btn").css("opacity",1),clearInterval(_),_=setInterval((function(){e<=.3&&i.find("#lb_button-wrapper .lb_call-btn").css("opacity",.7),clearInterval(_)}),500),(150<n.$(document).scrollTop()||.3<e)&&(clearInterval(null),i.find("#lb_button-wrapper").show(),i.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),300<n.$(document).scrollTop()&&.4<e&&i.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse"))}))):(i.find("#lb_button-wrapper").show(),i.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),"0"==n.W.chat?i.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse"):i.find("#lb_button-wrapper .lb_call-btn").css("opacity",1)),n.W.tooltip_scroll&&(h=null,n.$(document).on("scroll",(function(){clearInterval(h),.5<=n.$(document).scrollTop()/(n.$(document).innerHeight()-n.$(window).height())&&(h=setTimeout((function(){n.storage.localStorage.isEmpty("tooltip_closed")||!1===n.storage.localStorage.get("tooltip_closed")?void 0===i.find("#lb_button-call:hover")[0]&&i.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--hide")&&(i.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--hide").addClass("lb_button_tooltip--show"),setTimeout((function(){i.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--alert")}),3e3)):n.log("tooltip_closed"),clearTimeout(h)}),500))}))),n.W.tooltip_hover&&i.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--hover"),i.find("#lb_button-wrapper .lb_button_tooltip .lb_button_tooltip--close").on("click",(function(e){i.find("#lb_button-wrapper .lb_button_tooltip--container").remove(),n.storage.localStorage.set("tooltip_closed",!0)}))}i.find("#lb_exit").on("click",(function(){n.hideWidget(i)})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&(n.log("Escape key detected"),n.hideWidget(i))}))}i.on("click",".lb_eula--link",(function(e){e.preventDefault(),e.stopPropagation(),n.showEula(n.$(this).attr("href"))})),i.on("click","#lb_eula_widget-wrapper",(function(){n.hideEula()}));var p,f=n.getPhonePrefix();i.on("focus","#lb_phone",(function(){var e=n.$(this);""==e.val()&&e.val(f),e.val()==f&&setTimeout((function(){e.get(0).selectionStart=e.get(0).selectionEnd=100}),10)})).on("change","#lb_phone",(function(){var e=n.$(this).val().replace(/[^\d\+]+/g,"");n.$(this).val(e),!1!==(e=n.checkPhone(e))&&n.$(this).val(e)})).on("keypress","#lb_phone",(function(e){13==e.which&&(i.find("#lb_send").trigger("click"),e.preventDefault())})).on("paste","#lb_phone",(function(e){return e.preventDefault(),!1})).on("drop","#lb_phone",(function(e){return e.preventDefault(),!1})).attr("placeholder",f),i.on("click","#lb_send",(function(){var e;n.storage.localStorage.isEmpty("departments")?n.callTo(i):(e=i.find("#lb_phone").val(),!1!==(e=n.checkPhone(e))?(i.find("#lb_phone").removeClass("lb_error"),i.find("#lb_widget-invite").hide(),i.find("#lb_widget-scheduler").hide(),i.find("#lb_widget-form").hide(),i.find("#lb_widget-scheduler--controls").hide(),i.find("#lb_widget-department").show(),i.find("#lb_send--department").on("click",(function(){n.callTo(i)}))):i.find("#lb_phone").addClass("lb_error"))})),!n.W.active&&n.W.night_mode&&(i.find("#lb_timer").hide(),i.find(".lb_h6").css("visibility","hidden")),n.$("body").append(i),n.isMobile()&&i.find("#lb_widget-wrapper").show(),n.dom_is_ready=!0,(g=n.getCookie("__leadback_need_call"))?(n.log("Run magic_form"),n.removeCookie("__leadback_need_call",{path:"/"}),n.$("#lb_phone").val(g.phone),g.form_type&&-1!==["magic_form","manual_form"].indexOf(g.form_type)||(g.form_type="magic_form"),m={},"magic_form"===g.form_type?m.initiator="magic_forms":"manual_form"===g.form_type&&(m.initiator="manual_forms"),void 0!==n.W.magic_forms_callback&&"show"===n.W.magic_forms_callback&&n.showWidget(i),void 0!==g.label&&(m.label=g.label),n.callTo(i,m)):(t?n.showWidget(i):void 0!==n.W.catch_on_exit&&!n.W.catch_on_exit||n.startCursometer(i),void 0!==n.W.catch_by_timer&&n.W.catch_by_timer&&(p=1e3*n.W.catch_by_timer_time,void 0===n.getCookie(n.ct)?setTimeout((function(){n.log("Time show after: "+p),n.showWidget(i),n.setCookie(n.ct,{campaign:n.W.widget_key,user_id:n.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*n.W.timeout)})}),p):n.log("Time show timeout"))),"function"==typeof window.muse_init&&n.$("body").addClass("initialized")},dataType:"jsonp",jsonpCallback:"jsonpWidgetCallback"}),void 0!==n.W.magic_forms&&(o=!1,!n.W.active&&n.W.night_mode&&"off"===n.W.magic_forms_night_mode&&(o=!0),"none"!==n.W.magic_forms&&!1===o))if("manual"===n.W.magic_forms){if(n.form_settings=n.storage.localStorage.get("form_settings"),!1!==n.form_settings&&n.form_settings.forms&&n.form_settings.forms.length){n.log("FORM SETTINGS RECEIVED AND ACTIVE",n.form_settings);var i,a=[],l=n.form_settings.use_custom_selector&&Number(n.form_settings.use_custom_selector);for(l&&a.push({selector:"form.lb-magic-form",data:null}),i=0;i<n.form_settings.forms.length;i++)l?a.push({selector:n.form_settings.forms[i].selector+":not(.lb-magic-form)",data:n.form_settings.forms[i]}):a.push({selector:n.form_settings.forms[i].selector,data:n.form_settings.forms[i]});for(n.log(">>> form selectors getted",a),i=0;i<a.length;i++){var r,s=n.$(a[i].selector);s&&s.length&&(s.data("form-data",a[i].data),n.log(">>> form with selector",a[i].selector,"found"),n.DEBUG&&s.attr("style","border: 1px solid red !important"),s.hasClass("lb-magic-form")?(n.log(">>> magic form detected"),s.on("submit",(function(){var e=n.getPhoneByInputSelector("input",this);e&&n.setNeedCallCookie(e,n.$(this).data("magic-form-label"),"magic_form")}))):"onSubmit"===s.data("form-data").event?s.on("submit",function(){n.log(">>> manual form onSubmit");var e=n.getManualFormPhone(this);e&&(Number(this.data("form-data").has_redirect)?(n.log(">>> manual form has redirect, setting cookie"),n.setNeedCallCookie(e,this.data("form-data").name,"manual_form")):(n.log(">>> manual form has no redirect, calling from widget"),n.$("#lb_phone").val(e),e={initiator:"manual_forms"},void 0!==n.W.magic_forms_callback&&"show"===n.W.magic_forms_callback&&n.showWidget(n.$("#lb_widget-root")),e.label=this.data("form-data").name,n.callTo(n.$("#lb_widget-root"),e)))}.bind(s)):s.data("form-data").button_selector&&(n.log(">>> manual form onClick"),(r=s.find(s.data("form-data").button_selector))&&r.length&&(n.log(">>> manual form onClick has button with settings selector"),r.on("click",function(){var e=n.getManualFormPhone(this);e&&(Number(this.data("form-data").has_redirect)?(n.log(">>> manual form onClick has redirect setting cookie"),n.setNeedCallCookie(e,this.data("form-data").name,"manual_form")):(n.log(">>> manual form has no redirect, calling from widget"),n.$("#lb_phone").val(e),e={initiator:"manual_forms"},void 0!==n.W.magic_forms_callback&&"show"===n.W.magic_forms_callback&&n.showWidget(n.$("#lb_widget-root")),e.label=this.data("form-data").name,n.callTo(n.$("#lb_widget-root"),e)))}.bind(s)))))}}}else o="","custom"===n.W.magic_forms&&(o=".lb-magic-form"),n.$("form"+o).on("submit",(function(e){var t=n.getPhoneByInputSelector("input",this);t&&n.setNeedCallCookie(t,n.$(this).data("magic-form-label"),"magic_form")}))},n.getManualFormPhone=function(e){var t,o,i=null;return e.data("form-data").fields&&e.data("form-data").fields.length&&(t=e.data("form-data").fields.filter((function(e){return"phone"===e.type&&""!==e.selector.trim()})))&&t.length&&(t=t[0],(o=e.find(t.selector))&&o.length&&(n.log(">>> Result phone found by settings field selector",t.selector),i=n.checkPhone(o.val()))),i||(i=n.getPhoneByInputSelector("input",e),n.log(">>> Getting result phone by all inputs",i)),i},n.setNeedCallCookie=function(e,t,o){n.setCookie("__leadback_need_call",{phone:e,label:t,form_type:o},{path:"/",expires:new Date((new Date).getTime()+6e4)})},n.getPhoneByInputSelector=function(e,t){var o=[];n.$(e,t).each((function(e,t){var i,a=0;if(void 0!==n.$(t).attr("type")){if(i=n.$(t).attr("type"),-1===["tel","text"].indexOf(i))return;"tel"===i&&(a+=50)}void 0!==n.$(t).attr("name")&&(i=n.$(t).attr("name"),-1!==["phone","number","callback","tel","telephone"].indexOf(i)&&(a+=50)),!1!==(t=n.checkPhone(t.value))&&(o[o.length]={value:t,priority:a})}));var i=null;if(0<o.length)for(var a=0,l=o.length;a<l;a++)(null===i||o[a].priority>i.priority)&&(i=o[a]);return i?i.value:null},n.checkPhone=function(e){return("7"!=(e="789"==(e="8"==(e="495"!=(e="9"==(e=e.replace(/[^\d]+/g,"")).substr(0,1)&&10==e.length?"7"+e:e).substr(0,3)&&"499"!=e.substr(0,3)&&"812"!=e.substr(0,3)&&"4832"!=e.substr(0,4)||10!=e.length?e:"7"+e).substr(0,1)&&11==e.length?"7"+e.substr(1):e).substr(0,3)&&12==e.length?"7"+e.substr(2):e).substr(0,1)||11==e.length)&&(11==e.length||12==e.length)&&"+"+e},n.startCursometer=function(e){n.restarted||n.isMobile()?n.log("IGNORE startCursometer"):(n.log("startCursometer"),n.$(window).cursometer({onUpdateSpeed:function(e,t){if(null!==e)return n.LAST_SPEED=t},updateSpeedRate:15}),n.$("html").mouseout((function(t){t=t||window.event,n.LAST_X_POSITION=t.clientX,n.LAST_Y_POSITION=t.clientY,0<n.LAST_Y_POSITION||n.LAST_X_POSITION<200||(n.total_time>=n.activity?(t=void 0===n.getCookie(n.cg)||!n.getCookie(n.cg).converted||n.W.allow_multiple_conversions,.225<n.LAST_SPEED&&t&&void 0===n.getCookie(n.ct)&&n.last_visit_timeout<300?(n.stat.x=n.LAST_X_POSITION,n.stat.y=n.LAST_Y_POSITION,n.stat.s=n.LAST_SPEED,n.showWidget(e),n.setCookie(n.ct,{campaign:n.W.widget_key,user_id:n.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*n.W.timeout)}),n.log("Set timeout "+n.W.timeout)):n.log("Impression timeout",n.last_visit_timeout,void 0===n.getCookie(n.ct))):n.log("activity",n.activity,n.total_time,n.last_visit_timeout))})))},n.showWidget=function(e){n.log("showWidget"),n.widgetIsShow(e)?n.log("IS now shoed"):("function"==typeof n.beforeOpenWidget&&n.beforeOpenWidget(),n.runCountDownTimers(),n.sendEvent("impression"),n.sendGoal("LEADBACK_OPEN"),e.show(),n.isMobile()?(e.find(".lb_mobile-wrapper").show(),n.mobileAdoptation()):(e.find("#lb_widget-wrapper").show(),e.find("#lb_phone").focus()),n.W.float_button&&e.find("#lb_button-wrapper").hide()),void 0!==n.W.hide_call_timer&&n.W.hide_call_timer&&e.find("#lb_timer").hide()},n.hideWidget=function(e){e.find("#lb_widget-scheduler").is(":visible")&&(e.find("#lb_widget-scheduler").hide(),e.find("#lb_widget-scheduler").data("opened",!1),e.find("#lb_widget-invite").show(),n.W.active&&e.find("#lb_timer").show(),e.find("#lb_widget-scheduler--controls").show()),n.isMobile()?(n.sendGoal("LEADBACK_CLOSE"),e.find(".lb_mobile-wrapper").hide(),n.mobileAdoptation()):(n.sendGoal("LEADBACK_CLOSE"),e.find("#lb_widget-wrapper").hide(),n.W.float_button&&e.find("#lb_button-wrapper").show())},n.startMultiButtonSlides=function(){return!!n.is_multibutton&&setInterval((function(){var e,t,o;n.dom_is_ready&&(e=null,n.$("#lb_widget-root .lb-button__slides .lb-button-slides__item").not(".lb-widget-panel__item--hide").each((function(o,i){n.$(i).hasClass("lb-button-slides__item--active")?(e=o,n.$(i).removeClass("lb-button-slides__item--active"),(t=n.$(i).data("slide-action"))&&n.$(i).closest(".lb-button-flipper__front").removeClass("lb-button-flipper__front--"+t)):null!==e&&(n.$(i).addClass("lb-button-slides__item--active"),e=null,(t=n.$(i).data("slide-action"))&&n.$(i).closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+t))})),null!==e&&((o=n.$("#lb_widget-root .lb-button__slides .lb-button-slides__item:first-child").not(".lb-widget-panel__item--hide")).addClass("lb-button-slides__item--active"),(t=o.data("slide-action"))&&o.closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+t)))}),1e4)},n.getUrlParameter=function(e){var t=location.search;return e=e.replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&"),e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t),t="",e&&0<e.length&&(t=e[1].replace(/\+/g," "),t=decodeURIComponent(t),t=(t=n.escapeHtml(t)).replace(/\_/g," ")),null===e?"":t},n.checkCanReplaceMacro=function(e){if("string"!=typeof e)return!1;for(var t=["/images/uploads/chat","https://leadback.ru/ya-money?payment=","https://leadback.ru/chat-payments?payment=","s3upload://","https://leadback.s3.eu-central-1.amazonaws.com/chat_uploads/","https://leadback.s3.eu-central-1.amazonaws.com/uploads/","https://leadback.s3.yandexcloud.net/chat_uploads/"],o=0;o<t.length;o++)if(0===e.indexOf(t[o]))return!1;return!0},n.parseQueryMacros=function(e){if(!n.checkCanReplaceMacro(e))return e;var t,o=e.match(/\[get\:([^\]\|]+)\|?([^\]\|]+)?\]/gm);if(null!==o&&o.length)for(var i=0,a=o.length;i<a;i++){var l,r=o[i].replace(/^\[/,"").replace(/\]$/,"");e=-1<(l=(r=r.substr(r.indexOf(":")+1)).lastIndexOf("|"))?""!==(t=n.getUrlParameter(r.substr(0,l)))?e.replace(o[i],t):e.replace(o[i],r.substr(l+1)):(t=n.getUrlParameter(r),e.replace(o[i],t))}return e},n.parseTimeMacros=function(e){if(!n.checkCanReplaceMacro(e))return e;for(var t,o=[],i=e.match(/\[(time)(\+|\-)?(\d+)?\]/gim),a=0,l=(o=null!==i?i:o).length;a<l;a++){var r=new Date,s=o[a].replace(/[\[\]]/g,"");-1<s.indexOf("-")?(t=Number(s.split("-")[1]),r.setMinutes(r.getMinutes()-t)):-1<s.indexOf("+")&&(t=Number(s.split("+")[1]),r.setMinutes(r.getMinutes()+t)),e=e.replace(o[a],r.toLocaleTimeString().substr(0,r.toLocaleTimeString().lastIndexOf(":")))}return e},n.parseMacros=function(e){return n.checkCanReplaceMacro(e)?(e=n.parseTimeMacros(e),e=n.parseQueryMacros(e)):e},n.getCountDownType=function(e){return!e||e.match(/^([0-9]{2,4})-([0-1][0-9])-([0-3][0-9])\s?(?:([0-2][0-9]):([0-5][0-9]):([0-5][0-9]))?$/)?"date":e.match(/time\+(\d+d;?)?(\d+h;?)?(\d+m;?)?/)?"time":e.match(/(\d+h;?)?(\d+m;?)?(\d+s;?)?/)?"none":"date"},n.addDays=function(e,t){return e.setTime(e.getTime()+24*t*60*60*1e3),e},n.addHours=function(e,t){return e.setTime(e.getTime()+60*t*60*1e3),e},n.addMinutes=function(e,t){return e.setTime(e.getTime()+60*t*1e3),e},n.addSeconds=function(e,t){return e.setTime(e.getTime()+1e3*t),e},n.parseCountDownMacros=function(e){if(!n.checkCanReplaceMacro(e))return e;for(var t,o=/\[countdown\|([^\]\|]+)\|?([^\]\|]+)?\|?([^\]\|]+)?\|?([^\]\|]+)?]/gi;null!==(t=o.exec(e));){var i,a,l,r,s,c,d="",u="";switch(n.getCountDownType(t[1])){case"date":d=t[1];break;case"time":for(s=t[1].replace("time+","").split(";"),c=0;c<s.length;c++)-1<s[c].indexOf("d")&&(i=s[c].replace("d","")),-1<s[c].indexOf("h")&&(a=s[c].replace("h","")),-1<s[c].indexOf("m")&&(l=s[c].replace("m",""));f=n.visit_date,i&&""!==i&&(f=n.addDays(f,i)),a&&""!==a&&(f=n.addHours(f,a)),l&&""!==l&&(f=n.addMinutes(f,l)),r&&""!==r&&(f=n.addSeconds(f,r));var g=new Intl.DateTimeFormat("ru",{year:"numeric"}).format(f),h=new Intl.DateTimeFormat("ru",{month:"2-digit"}).format(f),_=new Intl.DateTimeFormat("ru",{day:"2-digit"}).format(f),m=Number(new Intl.DateTimeFormat("ru",{hour:"2-digit"}).format(f)),p=Number(new Intl.DateTimeFormat("ru",{minute:"2-digit"}).format(f)),f=Number(new Intl.DateTimeFormat("ru",{second:"numeric"}).format(f));d=g+"-"+h+"-"+_+" "+(m=m<10?"0"+m.toString():m)+":"+(p=p<10?"0"+p.toString():p)+":"+(f=f<10?"0"+f.toString():f);break;case"none":for(s=t[1].replace("time+","").split(";"),d="",c=u=0;c<s.length;c++)-1<s[c].indexOf("h")&&(a=s[c].replace("h",""),u+=3600*Number(a)),-1<s[c].indexOf("m")&&(l=s[c].replace("m",""),u+=60*Number(l)),-1<s[c].indexOf("s")&&(r=s[c].replace("s",""),u+=Number(r))}e=e.replace(t[0],'<span class="lbwidget-countdown" data-ttl="'+u+'" data-date="'+d+'" data-tpl="'+(t[2]||"")+'" data-expire="'+(t[3]||"")+'" data-format="'+(t[4]||"")+'"></span>')}return e},n.runCountDownTimers=function(){try{clearInterval(n.countDownInterval)}catch(e){}n.replaceTTLDate(),n.setCountDownText(),n.countDownInterval=setInterval((function(){n.setCountDownText()}),1e3)},n.replaceTTLDate=function(){for(var e=n.$("span.lbwidget-countdown"),t=0;t<e.length;t++){var o,i,a,l,r,s,c=n.$(e[t]);c.data("ttl")&&""!==c.data("ttl")&&((s=new Date).setTime(s.getTime()+1e3*Number(c.data("ttl"))+1e3),o=new Intl.DateTimeFormat("ru",{year:"numeric"}).format(s),i=new Intl.DateTimeFormat("ru",{month:"2-digit"}).format(s),a=new Intl.DateTimeFormat("ru",{day:"2-digit"}).format(s),l=Number(new Intl.DateTimeFormat("ru",{hour:"2-digit"}).format(s)),r=Number(new Intl.DateTimeFormat("ru",{minute:"2-digit"}).format(s)),s=Number(new Intl.DateTimeFormat("ru",{second:"numeric"}).format(s)),l<10&&(l="0"+l.toString()),r<10&&(r="0"+r.toString()),s<10&&(s="0"+s.toString()),c.data("date",o+"-"+i+"-"+a+" "+l+":"+r+":"+s),c.attr("data-date",o+"-"+i+"-"+a+" "+l+":"+r+":"+s),c.data("ttl",""),c.removeAttr("ttl"))}},n.countdownTimeDeclensions={hour:["час","часа","часов"],minute:["минута","минуты","минут"],second:["секунда","секунды","секунд"]},n.declension=function(e,t,o,i,n){t=null==t?"":t,o=null==o?"я":o,i=null==i?"и":i,n=null==n?"й":n;var a=(e=null==e?0:e)%100,l="";if(10<=e&&e<=20||10<=a&&a<=20)l=n;else switch(e%10){case 1:l=o;break;case 2:case 3:case 4:l=i;break;default:l=n}return t+l},n.prepareCountDownText=function(e,t,o,i){if(e.data("date")&&""!==e.data("date")&&(a=Date.parse(e.data("date"))),isNaN(a)||!a)return"";4!==(i=(i=i||"дн. ,:,:,").split(",")).length&&(i="дн. ,:,:,".split(","));var a,l,r,s,c=a-(new Date).getTime(),d="";return 0<=c?(l=Math.floor(c/864e5),s=Math.floor(c%864e5/36e5),r=Math.floor(c%36e5/6e4),e=Math.floor(c%6e4/1e3),a=0<l?l+i[0]:"",l=(c=i[1]).replace(/[^а-яё]/gi,""),l=n.$.trim(l.toLowerCase()),-1<(l=n.countdownTimeDeclensions.hour.indexOf(l))&&(c=c.replace(n.countdownTimeDeclensions.hour[l],n.declension(s,"час","","а","ов"))),l=s<10?"0"+s.toString()+c:s.toString()+c,c=(s=i[2]).replace(/[^а-яё]/gi,""),c=n.$.trim(c.toLowerCase()),-1<(c=n.countdownTimeDeclensions.minute.indexOf(c))&&(s=s.replace(n.countdownTimeDeclensions.minute[c],n.declension(r,"минут","а","ы",""))),r=r<10?"0"+r.toString()+s:r.toString()+s,i=(s=i[3]).replace(/[^а-яё]/gi,""),i=n.$.trim(i.toLowerCase()),-1<(i=n.countdownTimeDeclensions.second.indexOf(i))&&(s=s.replace(n.countdownTimeDeclensions.second[i],n.declension(e,"секунд","а","ы",""))),d=a+l+r+(e<10?"0"+e.toString()+s:e.toString()+s),t&&(-1===t.indexOf("%s")&&(t+=" %s"),d=t.replace("%s",d))):o&&(d=o),d},n.setCountDownText=function(){var e=n.$("span.lbwidget-countdown");if(0===e.length)return clearInterval(n.countDownInterval),!1;for(var t=0;t<e.length;t++){var o=n.$(e[t]),i=""!==o.data("tpl")?o.data("tpl"):null,a=""!==o.data("expire")?o.data("expire"):null,l=""!==o.data("format")?o.data("format"):null;l=n.prepareCountDownText(o,i,a,l);o.html(l)}},n.parseWidgetText=function(e){for(var t=e.find(".lb-parse-text"),o=0;o<t.length;o++){var i=n.$(t[o]),a=i.html();"string"==typeof a&&(i.hasClass("lb-parse-inline")&&(a=n.parseInlineTemplates(a)),a=n.parseMacros(a),a=n.parseCountDownMacros(a),i.html(a))}},n.getReplacedTags=function(){return n.replacedTags},n.parseInlineTemplates=function(e){if(!n.checkCanReplaceMacro(e))return e;var t=[],o=e.match(/\[\#([^\#\|\]]+)\]/gm);null!==o&&(t=o);for(var i=0,a=(t=null!==(o=e.match(/\[\#([^\#\|\]]+)\|([^\]]+)\]/gm))?t.concat(o):t).length;i<a;i++){var l=[],r=(l=0<t[i].indexOf("|")?t[i].replace(/[\[\]]/g,"").split("|"):[t[i].replace(/[\[\]]/g,""),""],n.$(l[0]));0<r.length&&""!=n.$.trim(r.text())?(e=e.replace(t[i],r.text()),n.replacedTags[l[0].replace("#","")]=r.text()):(e=e.replace(t[i],l[1]),n.replacedTags[l[0].replace("#","")]=l[1])}return e},n.widgetIsShow=function(e){return(n.isMobile()?e.find(".lb_mobile-wrapper"):e.find("#lb_widget-wrapper")).is(":visible")},n.showEula=function(e){n.$("#lb_eula_widget-wrapper").show(),n.$("#lb_eula--frame").attr("src",e)},n.hideEula=function(){n.$("#lb_eula_widget-wrapper").hide(),n.isMobile()||n.$("#lb_phone").focus()},n.callTo=function(e,t){n.log("callTo"),n.sendEvent("before_call");var o=e.find("#lb_phone").val();if(!1!==(o=n.checkPhone(o))){e.find("#lb_phone").removeClass("lb_error"),n.sendGoal("LEADBACK_CALL",t),void 0!==n.W.hide_call_timer&&n.W.hide_call_timer?e.find(".lb_show_when_calling").hide():(n.startTimer(e),e.find(".lb_show_when_calling").show()),e.find(".lb_hide_when_calling").hide(),e.find("#lb_send").off("click"),e.find("#lb_button_call_success").off("click").on("click",(function(){n.stopTimer(e),e.find(".lb_hide_when_call_answered").hide(),e.find(".lb_show_when_call_answered").show()})),e.find("#lb_button_call_success--department").off("click").on("click",(function(){n.stopTimer(e),e.find(".lb_hide_when_call_answered").hide(),e.find(".lb_show_when_call_answered").show()})),e.find("#lb_widget-scheduler--controls").hide();var i="";!0===e.find("#lb_widget-scheduler").data("opened")&&(i=e.find("#lb_widget-scheduler--days").val()+" "+e.find("#lb_widget-scheduler--times").val());var a,l,r="",s="",c=!n.storage.localStorage.isEmpty("departments"),d="";return"object"==typeof t&&(void 0!==t.delayed&&(i=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(t.delayed)?t.delayed:(l=["00","0",""],(a=new Date).setSeconds(a.getSeconds()+parseInt(t.delayed,10)),a.getFullYear()+"-"+(l[new String(a.getMonth()+1).length]+new String(a.getMonth()+1))+"-"+(l[new String(a.getDate()).length]+new String(a.getDate()))+" "+(l[new String(a.getHours()).length]+new String(a.getHours()))+":"+(l[new String(a.getMinutes()).length]+new String(a.getMinutes()))+":"+(l[new String(a.getSeconds()).length]+new String(a.getSeconds()))),n.log("SET delayed_time",i)),void 0!==t.label&&(r=t.label),void 0!==t.initiator&&(s=t.initiator),c&&void 0!==t.department&&(d=t.department)),n.log("Department assigned",d),""===d&&c&&(d=e.find('#lb_widget-department--items input[name="lb_widget-department--value"]:checked').val()),n.$.ajax({type:"GET",async:!0,url:n.PUBLIC_SERVER+"backend/widget_call.php",data:{site:window.location.host,phone:o,widget_key:n.W.widget_key,user_id:n.W.user_id,delayed:i,tz:n.getTz(),guid:n.getCookie(n.cg).guid,calltouch:window.calltouch_phone||window.calltouch_phone_1||window.calltouch_phone_2||"",department:d,label:r,initiator:s,cache:Math.random()},success:function(o){return n.setCookie(n.cg,{guid:n.getCookie(n.cg).guid,converted:!0},{path:"/",expires:99999}),"delayed"==o.result?(n.stopTimer(e),e.find(".lb_widget-container").hide(),e.find(".lb_widget-message").show(),e.find(".lb_delay-date").text(o.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),e.find(".lb_delay-time").text(o.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1")),e.find("#lb_close").on("click",(function(){e.hide(),n.isMobile()&&n.mobileAdoptation()}))):n.isMobile()&&"success"==o.result?(e.find(".lb_widget-container").hide(),e.find(".lb_widget-message").show(),e.find(".lb_message_title--delayed").hide(),e.find(".lb_message_title--success").show(),e.find("#lb_close").on("click",(function(){e.hide(),n.isMobile()&&n.mobileAdoptation()}))):"notice"===o.result&&n.showNotice(e,o),void 0===n.W.hide_call_timer||!n.W.hide_call_timer||"success"!==o.result&&"delayed"!==o.result||n.showNotice(e,o),"success"!=o.result&&"delayed"!=o.result&&"notice"!=o.result||"delayed"===o.result&&o.exists||n.sendEvent("call"),"function"==typeof n.successCallCallback&&(o.params=t,n.successCallCallback(o)),void 0!==n.Chat.widget_key&&void 0!==o.data&&void 0!==o.data.callback_phone&&""!=o.data.callback_phone&&n.Chat.sendEvent("set_profile",{profile:{phone:o.data.callback_phone}}),n.log("Call Success")},error:function(){return n.log("Call Error!")},dataType:"jsonp",jsonpCallback:"jsonpCallCallback"})}e.find("#lb_phone").addClass("lb_error")},n.showNotice=function(e,t){e.find(".lb_widget-container").hide(),e.find(".lb_widget-message").show(),t.time&&""!==t.time?(e.find(".lb_delay-date").text(t.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),e.find(".lb_delay-time").text(t.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1"))):(e.find(".lb_message_title--delayed").hide(),e.find(".lb_message_title--success").show()),e.find("#lb_close").on("click",(function(){e.hide(),n.isMobile()&&n.mobileAdoptation()}))},n.startTimer=function(e){n.log("startTimer"),n.interval=setInterval((function(){var t=n.timer-46;t<=0&&(t=0,clearInterval(n.interval)),n.timer=t,n.timerHtml(e)}),46)},n.stopTimer=function(e){n.log("stopTimer"),clearInterval(n.interval)},n.timerHtml=function(e){var t=0,o=Math.floor(n.timer/1e3).toString();t=Math.round((n.timer-1e3*o)/10).toString();o=o.length<2?"0"+o:o,t=t.length<2?"0"+t:2<t.length?"00":t,e.find("#lb_timer_result").text("0:"+o+","+t)},n.sendEvent=function(e,t){return n.log("sendEvent",e,t),n.$.ajax({type:"GET",async:!0,url:n.PUBLIC_SERVER+"backend/widget_event.php",data:{type:e,widget_key:n.W.widget_key,user_id:n.W.user_id,guid:n.getCookie(n.cg).guid,ga_cid:n.getGoogleCid(),ya_cid:n.ya_cid,ya_counter:n.ya_counter,roistat:n.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),comagic_session_id:n.getComagicSessionId(),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(){return n.log("Event Stat ["+e+"] Success")},error:function(){return n.log("Event Stat ["+e+"] Error!")},dataType:"jsonp",jsonpCallback:"jsonpEventCallback_"+e})},n.getComagicSessionId=function(){return window.Comagic&&"function"==typeof window.Comagic.getSessionId?(n.log("!!! Getting comagic",window.Comagic,window.Comagic.getSessionId()),window.Comagic.getSessionId()):""},n.analytics=function(e){return n.log("sendAnalytics",e),n.$.ajax({type:"GET",async:!0,url:n.PUBLIC_SERVER+"backend/widget_analytics.php",data:{data:e,cache:Math.random()},success:function(){},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpAnalyticsCallback"})},n.sendGoal=function(e,t){if(n.log("Call sendGoal"),!1!==n.Events._callEvent("onGoalEvent",{goal:e,params:t})){if(n.log("Send GOAL GA:"+e),"function"==typeof ga&&(ga("send","event",e,"clicked"),ga("ldbckTracker.send","event",e,"clicked")),"function"==typeof gtag&&gtag("event",e,{event_category:e,event_action:"clicked"}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:e}),0<n.ya.length)for(var o=n.ya.length-1;0<=o;o--)n.log("Send GOAL YA("+n.ya[o]+"):"+e),window[n.ya[o]].reachGoal(e);"LEADBACK_CALL"==e&&""!=n.W.facebook_pixel_event&&(n.log("track fb event "+n.W.facebook_pixel_event),""!=n.W.facebook_pixel_id?(t='<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id='+encodeURIComponent(n.W.facebook_pixel_id)+"&ev="+encodeURIComponent(n.W.facebook_pixel_event)+'&noscript=1"/>',n.log("nonscript pixel"),n.$("body").append(t)):"function"==typeof fbq?fbq("track",n.W.facebook_pixel_event):n.log("need pixel ID"))}},n.getPhonePrefix=function(){var e,t={ru:"+7",ua:"+380",by:"+375",kz:"+77",ge:"+995"},o="";for(e in void 0!==n.W&&(o=n.W.country),t)if(e==o)return t[o];return""},n.getTz=function(){return-(new Date).getTimezoneOffset()/60},n.load_jQuery=function(){var e;n.log("load_jQuery");var t={jquery:"none",widget:_emv.campaign};return void 0!==window.jQuery&&(n.log("Site use jquery "+window.jQuery.fn.jquery),t.jquery=window.jQuery.fn.jquery),void 0!==window.jQuery&&(e=window.jQuery.fn.jquery,0<=inArray.call(n.JQUERY_VERSIONS,e))?(n.log("jQuery "+jQuery.fn.jquery+" is present and meets our requirements."),n.$=window.jQuery,n.init(),n.analytics(t)):(n.log("jQuery is not present."),n.getScript(n.JQUERY_URL,(function(){if("undefined"!=typeof jQuery)return n.$=jQuery.noConflict(!0),n.log("jQuery version "+n.$.fn.jquery+" successfully loaded."),n.init(),n.analytics(t)})))},n.getScript=function(e,t){var o,i,a;return n.log("getScript",e),(a=document.createElement("script")).src=e,i=document.getElementsByTagName("head")[0],o=!1,a.onload=a.onreadystatechange=function(){if(!(o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState))return o=!0,t(),a.onload=a.onreadystatechange=null,i.removeChild(a)},i.appendChild(a)},n.loadScript=function(e,t,o){var i,a,l,r;return n.log("loadScript",e),a=!1,l=null,(i=n.$).isFunction(t)?(l=t,a=o||a):(a=t||a,l=o||l),r=!0,i('script[type="text/javascript"]').each((function(){return r=e!==i(this).attr("src")})),r?i.ajax({type:"GET",url:e,success:l,dataType:"script",cache:a}):i.isFunction(l)?l.call(this):void 0},n.generateUUID=function(){var e,t;return n.log("generateUUID"),e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?o:7&o|8).toString(16)})),n.sendUUID(t),t},n.sendUUID=function(e){n.log("sendUUID",e,_emv.campaign),n.$.ajax({type:"GET",url:n.PUBLIC_SERVER+"backend/widget_uuid.php",dataType:"json",data:{widget_key:_emv.campaign,uuid:e,ga_cid:n.getGoogleCid(),ya_cid:n.ya_cid,ya_counter:n.ya_counter,roistat:n.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),comagic_session_id:n.getComagicSessionId(),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(e){n.log("UUID",e)},error:function(){n.log("UUID error")},dataType:"jsonp",jsonpCallback:"jsonpUuidCallback"})},n.isMobile=function(){return!n.is_vk&&(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4)))},n.isIpad=function(){return/ipad/i.test(navigator.userAgent||navigator.vendor||window.opera)},n.isIOS=function(){return/ip(hone|od|ad)/i.test(navigator.userAgent||navigator.vendor||window.opera)},n.isTouch=function(){return"ontouchstart"in window||navigator.maxTouchPoints||window.DocumentTouch&&document instanceof DocumentTouch},n.mobileButton=function(e,t){n.log("call mobileButton");var o=80/n.screen_width,i=window.innerWidth*o,a=window.innerWidth/2-.5*i+window.pageXOffset;o=window.innerHeight-1.25*i+window.pageYOffset;null!==e&&(e.css("width",i),e.css("height",i),e.css("left",a),e.css("top",o),e.find("object").css("width",i),e.find("img").css("width",i)),t.css("width",n.screen_width+"px"),t.css("height",n.screen_height+"px"),i=n.screen_width/window.innerWidth,t.css("zoom",1/i),t.css("top",window.pageYOffset*i),t.css("left",window.pageXOffset*i)},n.default_viewport=null,n.default_viewport_is_mobile=!1,n.mobileAdoptation=function(){if(n.$("html").hasClass("lb-site-hide"))n.$("html").removeClass("lb-site-hide"),!1===n.default_viewport?n.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=0.33"):n.default_viewport&&n.$("meta[name=viewport]").attr("content",n.default_viewport),(e=n.$("html").data("ldbck_save_scroll"))&&n.$(document).scrollTop(e);else{var e=n.$(document).scrollTop();if(n.$("html").data("ldbck_save_scroll",e),n.$("html").addClass("lb-site-hide"),0==n.$("meta[name=viewport]").length)n.default_viewport=!1,n.$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">');else if(null===n.default_viewport){n.default_viewport=n.$("meta[name=viewport]").attr("content");for(var t,o=n.default_viewport.split(","),i=!1,a=0;a<o.length;a++){o[a]=o[a].replace(/^\s+/,"");var l=o[a].split("=");"initial-scale"==l[0]&&(t=l[1]),"maximum-scale"==l[0]&&(i=l[1])}if(1==t&&1==i)return void(n.default_viewport_is_mobile=!0);n.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}else n.default_viewport_is_mobile||n.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}var r;"1"!=n.W.chat&&(r=n.$("#lb_mobile-call"),e=n.$(".lb_mobile-wrapper"),r&&e&&n.mobileButton(r,e))},n.escapeHtml=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return t[e]}))},n.randomVal=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},n.log=function(e){var t;n.debug_window&&((t=document.getElementById("ldbck_debug_window"))||((t=document.createElement("div")).id="ldbck_debug_window",t.style="position: absolute; top: 0; left: 0; width: 100%; background-color: rgba(0,0,0,.2); color: white; z-index:9999;",document.body.appendChild(t)),document.getElementById("ldbck_debug_window").innerHTML+="<div>"+e+": "+JSON.stringify(arguments)+"</div>"),!ldbck.DEBUG&&"#debug"!=window.location.hash||((t=Array.prototype.slice.call(arguments)).unshift((new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds()+" "),console.log.apply(console,t))},n.initStorage=function(e){return function(e){function t(t){var o,i,n,a=arguments.length,l=window[t],r=arguments,s=r[1];if(a<2)throw new Error("Minimum 2 arguments must be given");if(e.isArray(s)){for(var c in i={},s){o=s[c];try{i[o]=JSON.parse(l.getItem(o))}catch(t){i[o]=l.getItem(o)}}return i}if(2!=a){try{i=JSON.parse(l.getItem(s))}catch(t){throw new ReferenceError(s+" is not defined in this storage")}for(c=2;c<a-1;c++)if(void 0===(i=i[r[c]]))throw new ReferenceError([].slice.call(r,1,c+1).join(".")+" is not defined in this storage");if(e.isArray(r[c])){for(var d in n=i,i={},r[c])i[r[c][d]]=n[r[c][d]];return i}return i[r[c]]}try{return JSON.parse(l.getItem(s))}catch(t){return l.getItem(s)}}function o(t){var o,i,n=arguments.length,a=window[t],l=arguments,r=l[1],s=l[2],c={};if(n<2||!e.isPlainObject(r)&&n<3)throw new Error("Minimum 3 arguments must be given or second parameter must be an object");if(e.isPlainObject(r)){for(var d in r)o=r[d],e.isPlainObject(o)?a.setItem(d,JSON.stringify(o)):a.setItem(d,o);return r}if(3==n)return"object"==typeof s?a.setItem(r,JSON.stringify(s)):a.setItem(r,s),s;try{null!=(i=a.getItem(r))&&(c=JSON.parse(i))}catch(t){}i=c;for(d=2;d<n-2;d++)i[o=l[d]]&&e.isPlainObject(i[o])||(i[o]={}),i=i[o];return i[l[d]]=l[d+1],a.setItem(r,JSON.stringify(c)),c}function i(t){var o,i,n=arguments.length,a=window[t],l=arguments,r=l[1];if(n<2)throw new Error("Minimum 2 arguments must be given");if(e.isArray(r)){for(var s in r)a.removeItem(r[s]);return!0}if(2==n)return a.removeItem(r),!0;try{o=i=JSON.parse(a.getItem(r))}catch(t){throw new ReferenceError(r+" is not defined in this storage")}for(s=2;s<n-1;s++)if(void 0===(i=i[l[s]]))throw new ReferenceError([].slice.call(l,1,s).join(".")+" is not defined in this storage");if(e.isArray(l[s]))for(var c in l[s])delete i[l[s][c]];else delete i[l[s]];return a.setItem(r,JSON.stringify(o)),!0}function n(o){var i=arguments.length,a=arguments,r=(window[o],a[1]);if(1==i)return 0==l(o).length;if(e.isArray(r)){for(var s=0;s<r.length;s++)if(!n(o,r[s]))return!1;return!0}try{var c=t.apply(this,arguments);for(var s in e.isArray(a[i-1])||(c={totest:c}),c)if(!(e.isPlainObject(c[s])&&e.isEmptyObject(c[s])||e.isArray(c[s])&&!c[s].length)&&c[s])return!1;return!0}catch(o){return!0}}function a(o){var i=arguments.length,n=arguments,l=(window[o],n[1]);if(i<2)throw new Error("Minimum 2 arguments must be given");if(e.isArray(l)){for(var r=0;r<l.length;r++)if(!a(o,l[r]))return!1;return!0}try{var s=t.apply(this,arguments);for(var r in e.isArray(n[i-1])||(s={totest:s}),s)if(void 0===s[r]||null===s[r])return!1;return!0}catch(o){return!1}}function l(o){var i=arguments.length,n=window[o],a=arguments,l=(a[1],[]),r={};if((r=i>1?t.apply(this,a):n)&&r._cookie)for(var s in e.cookie())""!=s&&l.push(s.replace(r._prefix,""));else for(var c in r)l.push(c);return l}function r(t){if(!t||"string"!=typeof t)throw new Error("First parameter must be a string");s?(window.localStorage.getItem(t)||window.localStorage.setItem(t,"{}"),window.sessionStorage.getItem(t)||window.sessionStorage.setItem(t,"{}")):(window.localCookieStorage.getItem(t)||window.localCookieStorage.setItem(t,"{}"),window.sessionCookieStorage.getItem(t)||window.sessionCookieStorage.setItem(t,"{}"));var o={localStorage:e.extend({},e.localStorage,{_ns:t}),sessionStorage:e.extend({},e.sessionStorage,{_ns:t})};return e.namespaceStorages[t]=o,o}var s=function(e){var t="jsapi";try{return!!window[e]&&(window[e].setItem(t,t),window[e].removeItem(t),!0)}catch(e){return!1}}("localStorage"),c={_type:"",_ns:"",_callMethod:function(e,t){var o=[this._type],i=(t=Array.prototype.slice.call(t))[0];return this._ns&&o.push(this._ns),"string"==typeof i&&-1!==i.indexOf(".")&&(t.shift(),[].unshift.apply(t,i.split("."))),[].push.apply(o,t),e.apply(this,o)},get:function(){return this._callMethod(t,arguments)},set:function(){var t=arguments.length,i=arguments,n=i[0];if(t<1||!e.isPlainObject(n)&&t<2)throw new Error("Minimum 2 arguments must be given or first parameter must be an object");if(e.isPlainObject(n)&&this._ns){for(var a in n)o(this._type,this._ns,a,n[a]);return n}var l=this._callMethod(o,i);return this._ns?l[n.split(".")[0]]:l},remove:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(i,arguments)},removeAll:function(t){return this._ns?(o(this._type,this._ns,{}),!0):function(t,o){var n=l(t);for(var a in n)i(t,n[a]);if(o)for(var a in e.namespaceStorages)r(a)}(this._type,t)},isEmpty:function(){return this._callMethod(n,arguments)},isSet:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(a,arguments)},keys:function(){return this._callMethod(l,arguments)}};e.initNamespaceStorage=function(e){return r(e)},s?(e.localStorage=e.extend({},c,{_type:"localStorage"}),e.sessionStorage=e.extend({},c,{_type:"sessionStorage"})):(e.localStorage=e.extend({},c,{_type:"localCookieStorage"}),e.sessionStorage=e.extend({},c,{_type:"sessionCookieStorage"})),e.namespaceStorages={},e.removeAllStorages=function(t){e.localStorage.removeAll(t),e.sessionStorage.removeAll(t),e.cookieStorage&&e.cookieStorage.removeAll(t),t||(e.namespaceStorages={})}}(n.$),n.$.initNamespaceStorage("__"+e)},n.coBrowseV2=function(e){n.log("coBrowseV2"),Cloudim.Api.getCurrentOperator((function(t){!1!==t&&void 0===t.length&&Cloudim.Api.getVisitor((function(o){var i=n.$("html").clone();i.find("script").attr("src","").html(""),i.find(".app-cobrowsing").remove(),i.find("#lb_widget-root").html(""),i.find("audio").html(""),i.find("iframe#cloudim_chat").html(""),i={widget_key:n.W.widget_key,user_id:n.W.user_id,guid:n.getCookie(n.cg).guid,loc:document.location.href,operator:t.jid,visitor:o.jid,html:i.html()},n.$.post(n.PUBLIC_SERVER+"backend/widget_cobrowse.php",i,(function(t){"function"==typeof e&&e(t)}),"json")}))}))},n.Cookies=function e(t){function o(e,i,n){var a,l;if("undefined"!=typeof document){if(1<arguments.length){"number"==typeof(n=_({path:"/"},o.defaults,n)).expires&&((l=new Date).setMilliseconds(l.getMilliseconds()+864e5*n.expires),n.expires=l),n.expires=n.expires?n.expires.toUTCString():"";try{a=JSON.stringify(i),/^[\{\[]/.test(a)&&(i=a)}catch(e){}i=t.write?t.write(i,e):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var r,s="";for(r in n)n[r]&&(s+="; "+r,!0!==n[r]&&(s+="="+n[r]));return document.cookie=e+"="+i+s}e||(a={});for(var c=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,u=0;u<c.length;u++){var g=c[u].split("="),h=g.slice(1).join("=");this.json||'"'!==h.charAt(0)||(h=h.slice(1,-1));try{var m=g[0].replace(d,decodeURIComponent);h=t.read?t.read(h,m):t(h,m)||h.replace(d,decodeURIComponent);if(this.json)try{h=JSON.parse(h)}catch(e){}if(e===m){a=h;break}e||(a[m]=h)}catch(e){}}return a}}return(o.set=o).get=function(e){return o.call(o,e)},o.getJSON=function(){return o.apply({json:!0},[].slice.call(arguments))},o.defaults={},o.remove=function(e,t){o(e,"",_(t,{expires:-1}))},o.withConverter=e,o}((function(){})),n.Events={onChatReady:[],onGoalEvent:[],_callEvent:function(e,t){var o=!0;if(void 0!==n.Events[e]&&0<n.Events[e].length)for(var i in n.Events[e])!1===n.Events[e][i](t)&&(o=!1);return o}},n.Api={callTo:function(e,t){t=t&&"object"!=typeof t?{delayed:t}:t,n.$("#lb_phone").val(e),n.callTo(n.$("#lb_widget-root"),t)},callFromForm:function(e,t){n.$("#lb_phone").val(e),e={initiator:"magic_forms"},t&&"string"==typeof t&&""!==n.$.trim(t)&&(e.label=t),n.callTo(n.$("#lb_widget-root"),e)},bind:function(e,t){n.Events[e]&&(n.Events[e][n.Events[e].length]=t)}},0<n.onApiReady.length)for(l=0,r=n.onApiReady.length;l<r;l++)"function"==typeof n.onApiReady[l]&&n.onApiReady[l](n.Api);"object"==typeof window.Muse&&"function"==typeof window.muse_init?(n.log("Is Muse site"),n.muse_detect_interval=null,n.muse_interval=150,n.muse_stop_check=5e3,n.muse_step=0,n.muse_detect_interval=setInterval((function(){n.muse_step++,(!0===document.body.classList.contains("initialized")||n.muse_step>=n.muse_stop_check/n.muse_interval)&&(n.log("Muse Is initialized"),clearInterval(n.muse_detect_interval),n.muse_detect_interval=null,n.load_jQuery())}),n.muse_interval)):n.load_jQuery()}).call(this);